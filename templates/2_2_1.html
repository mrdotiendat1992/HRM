{% extends  "base.html" %}
{% block title %}Danh sách ứng viên tuyển dụng{% endblock title %}
{% block style%}
<style>
    .scroll-container {
        width: 100%;
        overflow-x: scroll;
    }

    .content {
        width: 200%;
    }
    table, th, td {
        font-size: 12px;
        font-weight:bold;
        border-collapse: collapse;
        text-align: center;
    }
    th {
        text-align: center;
        color: white;
    }
    td, th {
        white-space: nowrap;
        overflow: hidden;

    }
    label, p, input, h5 {
        color: #4e73df;
        font-weight: bold;
    }
    td {
        color: white;
    }

</style>
{% endblock style %}
{% block content %}
<div class="scroll-container">
    <div>
        <a class="btn btn-outline-danger" href="/muc2_2">Quay lại</a>
        <button type="button" class="btn btn-primary btn-sm" title="Thêm ứng viên mới" data-toggle="modal" data-target="#UVModal">
            Thêm ứng viên
        </button>
    </div>
    {% if current_user.phongban == "td" or current_user.phanquyen == "sa" %}
    <div class="modal fade" id="UVModal" tabindex="-1" role="dialog" aria-labelledby="UVModal" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="UVModalLabel">Ứng viên mới</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <form method="POST" enctype="multipart/form-data">
                <div class="modal-body">
                    <div class="container">
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <input type="number" name="id" hidden value={{request.args.get('id','')}}>
                                    <input type="text" name="phongban" hidden value={{ phongban }}>
                                    <label for="hoten">Họ tên</label>
                                    <input type="text" class="form-control" name="hoten" placeholder="Họ tên" required>
                                    <label for="gioitinh">Giới tính</label>
                                    <select type="text" class="form-control" name="gioitinh" required>
                                        <option value="Nam">Nam</option>
                                        <option value="Nữ">Nữ</option>
                                    </select>
                                    <label for="tuoi">Tuổi</label>
                                    <input type="number" class="form-control" name="tuoi" placeholder="Tuổi" min="18" step="1" required>
                                    <label for="namkinhnghiem">Năm kinh nghiệm</label>   
                                    <input type="number" class="form-control" name="namkinhnghiem" min="0.5" placeholder="Năm kinh nghiệm" step="0.5" required>
                                    <label for="linkcv">Tải lên CV:</label>
                                    <input type="file" class="form-control" name="linkcv" required>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <input type="submit" class="btn btn-primary" value="Tải lên"></input>
                    </form>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Quay lại</button>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    <br>
    <div class="content">
        <table class="table table-bordered table-hover table-sm">
            <thead>
                <tr class="bg-primary">
                    <th rowspan="2" style="vertical-align:middle;">Họ tên</th>
                    <th rowspan="2" style="vertical-align:middle;">Giới tính</th>
                    <th rowspan="2" style="vertical-align:middle;">Tuổi</th>
                    <th rowspan="2" style="vertical-align:middle;">Số năm kinh nghiệm</th>
                    <th rowspan="2" style="vertical-align:middle;">CV</th>
                    <th colspan="3">Phỏng vấn lần 1</th>
                    <th colspan="3">Phỏng vấn lần 2</th>
                    <th colspan="3">Phỏng vấn lần 3</th>
                    <th rowspan="2" style="vertical-align:middle;">Trạng thái</th>
                    <th rowspan="2" style="vertical-align:middle;">Ghi chú</th>
                    <th rowspan="2"></th>
                </tr>
                <tr class="bg-primary">
                    <th>Ngày</th>
                    <th>Kết quả</th>
                    <th>Đánh giá</th>
                    <th>Ngày</th>
                    <th>Kết quả</th>
                    <th>Đánh giá</th>
                    <th>Ngày</th>
                    <th>Kết quả</th>
                    <th>Đánh giá</th>
                </tr>
            </thead>
            <tbody>
                {% for row in danhsach %}
                {% if row[15]=="Qua phỏng vấn" %}
                <tr class="bg-success">
                {% elif row[15]=="Trượt phỏng vấn" %}
                <tr class="bg-danger">
                {% elif row[15]=="Đang phỏng vấn" %}
                <tr class="bg-info">
                {% else %}
                <tr class="bg-secondary">
                {% endif %}
                    <td>{{ row[1] }}</td>
                    <td>{{ row[2] }}</td>
                    <td>{{ row[3] }}</td>
                    <td>{{ row[4] }}</td>
                    <td>
                        {% if row[5] %}
                            <i class="fa fa-lg fa-search" aria-hidden="true" style="cursor: pointer;" onclick="openFile('{{ row[5] }}')"></i>
                        {% endif %}
                    </td>
                    <td>
                        {% if current_user.phanquyen == "td" or current_user.phanquyen == "sa" %}
                        <form action="/thaydoi_ngaypv1_yctd" method="POST">
                            <input type="date" name="ngaypv1" value="{{ row[6] }}" onchange="this.form.submit()">
                            <input type="hidden" name="id" value={{ row[0] }}>
                            <input type="hidden" name="id_yctd" value={{ row[17] }}>
                        </form>
                        {% else %}
                            {% if row[6] %}
                                <input type="date" value={{ row[6] }} readonly>
                            {% endif %}
                        {% endif %}
                    </td>
                    <td>
                        {% if current_user.phanquyen == "td" or current_user.phanquyen == "sa" %}
                        <form action="/thaydoi_ketquapv1_yctd" method="POST">
                            <select name="ketquapv1" onchange="this.form.submit()"> 
                                {% if row[7] == "pass" %}
                                <option selected>✔️</option>
                                <option value="failed">❌</option>
                                <option value="">⏳</option>
                                {% endif %}
                                {% if row[7] == "failed" %}
                                <option selected>❌</option>
                                <option value="pass">✔️</option>
                                <option value="">⏳</option>
                                {% endif %}
                                {% if not row[7] %}
                                <option value="pass">✔️</option>
                                <option value="failed">❌</option>
                                <option selected>⏳</option>
                                {% endif %}
                            </select>
                            <input type="hidden" name="id" value={{ row[0] }}>
                            <input type="hidden" name="id_yctd" value={{ row[17] }}>
                        </form>
                        {% else %}
                            {% if row[7] == "pass" %}
                            ✔️
                            {% elif row[7] == "failed" %}
                            ❌
                            {% elif not row[7] %}
                            ⏳
                            {% endif %}
                        {% endif %}
                    </td>
                    <td>
                        {% if row[8] %}
                        <button class="btn btn-danger">
                            <i class="fa fa-lg fa-file" aria-hidden="true" style="cursor: pointer;" onclick="openFile('{{ row[8] }}')"></td>
                        </button>
                        {% else %}
                            {% if current_user.phanquyen == "td" or current_user.phanquyen == "sa" %}
                            <button type="button" class="btn btn-primary btn-sm" title="Thêm ứng viên mới" data-toggle="modal" data-target="#KQUVModal1">
                                <i class="fa fa-upload" aria-hidden="true" style="cursor: pointer;"></i>
                            </button>
                            <div class="modal fade" id="KQUVModal1" tabindex="-1" role="dialog" aria-labelledby="UVModal" aria-hidden="true">
                                <div class="modal-dialog" role="document">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="KQUVModal1Label">File đánh giá kết quả phỏng vấn</h5>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                        </div>
                                        <form method="POST" action="/upload_danhgia_uvtd_pv1" enctype="multipart/form-data">
                                        <div class="modal-body">
                                            <div class="container">
                                                <div class="row">
                                                    <div class="col-sm-6">
                                                        <div class="form-group">
                                                            <input type="file" class="form-control" name="file" required>
                                                            <input type="hidden" name="id" value={{row[0]}}>
                                                            <input type="hidden" name="id_yctd" value={{row[17]}}>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <input type="submit" class="btn btn-primary" value="Tải lên"></input>
                                            </form>
                                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Quay lại</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                        {% endif %}
                    </td>
                    <td>
                        {% if current_user.phanquyen == "td" or current_user.phanquyen == "sa" %}
                        <form action="/thaydoi_ngaypv2_yctd" method="POST">
                            <input type="date" name="ngaypv2" value="{{ row[9] }}" onchange="this.form.submit()">
                            <input type="hidden" name="id" value={{ row[0] }}>
                            <input type="hidden" name="id_yctd" value={{ row[17] }}>
                        </form>
                        {% else %}
                            {% if row[9] %}
                                <input type="date" value={{ row[9] }} readonly>
                                {% endif %}
                        {% endif %}
                    </td>
                    <td>
                        {% if current_user.phanquyen == "td" or current_user.phanquyen == "sa" %}
                        <form action="/thaydoi_ketquapv2_yctd" method="POST">
                            <select name="ketquapv2" onchange="this.form.submit()"> 
                                {% if row[10] == "pass" %}
                                <option selected>✔️</option>
                                <option value="failed">❌</option>
                                <option value="">⏳</option>
                                {% endif %}
                                {% if row[10] == "failed" %}
                                <option selected>❌</option>
                                <option value="pass">✔️</option>
                                <option value="">⏳</option>
                                {% endif %}
                                {% if not row[10] %}
                                <option value="pass">✔️</option>
                                <option value="failed">❌</option>
                                <option selected>⏳</option>
                                {% endif %}
                            </select>
                            <input type="hidden" name="id" value={{ row[0] }}>
                            <input type="hidden" name="id_yctd" value={{ row[17] }}>
                        </form>
                        {% else %}
                            {% if row[10] == "pass" %}
                            ✔️
                            {% elif row[10] == "failed" %}
                            ❌
                            {% elif not row[10] %}
                            ⏳
                            {% endif %}
                        {% endif %}
                    </td>
                    <td>
                        {% if row[11] %}
                        <button class="btn btn-danger">
                            <i class="fa fa-lg fa-file" aria-hidden="true" style="cursor: pointer;" onclick="openFile('{{ row[11] }}')"></td>
                        </button>
                        {% else %}
                        {% if current_user.phanquyen == "td" or current_user.phanquyen == "sa" %}
                        <button type="button" class="btn btn-primary btn-sm" title="Thêm ứng viên mới" data-toggle="modal" data-target="#KQUVModal2">
                            <i class="fa fa-upload" aria-hidden="true" style="cursor: pointer;"></i>
                        </button>
                        <div class="modal fade" id="KQUVModal2" tabindex="-1" role="dialog" aria-labelledby="UVModal" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="KQUVModal2Label">File đánh giá kết quả phỏng vấn</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <form method="POST" action="/upload_danhgia_uvtd_pv2" enctype="multipart/form-data">
                                    <div class="modal-body">
                                        <div class="container">
                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <input type="file" class="form-control" name="file" required>
                                                        <input type="hidden" name="id" value={{row[0]}}>
                                                        <input type="hidden" name="id_yctd" value={{row[17]}}>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <input type="submit" class="btn btn-primary" value="Tải lên"></input>
                                        </form>
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Quay lại</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        {% endif %}
                    </td>
                    <td>
                        {% if current_user.phanquyen == "td" or current_user.phanquyen == "sa" %}
                        <form action="/thaydoi_ngaypv3_yctd" method="POST">
                            <input type="date" name="ngaypv1" value="{{ row[12] }}" onchange="this.form.submit()">
                            <input type="hidden" name="id" value={{ row[0] }}>
                            <input type="hidden" name="id_yctd" value={{ row[17] }}>
                        </form>
                        {% else %}
                            {% if row[12] %}
                                <input type="date" value={{ row[12] }} readonly>
                                {% endif %}
                        {% endif %}
                    </td>
                    <td>
                        {% if current_user.phanquyen == "td" or current_user.phanquyen == "sa" %}
                        <form action="/thaydoi_ketquapv3_yctd" method="POST">
                            <select name="ketquapv3" onchange="this.form.submit()"> 
                                {% if row[13] == "pass" %}
                                <option selected>✔️</option>
                                <option value="failed">❌</option>
                                <option value="">⏳</option>
                                {% endif %}
                                {% if row[13] == "failed" %}
                                <option selected>❌</option>
                                <option value="pass">✔️</option>
                                <option value="">⏳</option>
                                {% endif %}
                                {% if not row[13] %}
                                <option value="pass">✔️</option>
                                <option value="failed">❌</option>
                                <option selected>⏳</option>
                                {% endif %}
                            </select>
                            <input type="hidden" name="id" value={{ row[0] }}>
                            <input type="hidden" name="id_yctd" value={{ row[17] }}>
                        </form>
                        {% else %}
                        {% if row[13] == "pass" %}
                        ✔️
                        {% elif row[13] == "failed" %}
                        ❌
                        {% elif not row[13] %}
                        ⏳
                        {% endif %}
                        {% endif %}
                    </td>
                    <td>
                        {% if row[14] %}
                        <button class="btn btn-danger">
                            <i class="fa fa-lg fa-file" aria-hidden="true" style="cursor: pointer;" onclick="openFile('{{ row[14] }}')"></td>
                        </button>
                        {% else %}
                        {% if current_user.phanquyen == "td" or current_user.phanquyen == "sa" %}
                        <button type="button" class="btn btn-primary btn-sm" title="Thêm ứng viên mới" data-toggle="modal" data-target="#KQUVModal3">
                            <i class="fa fa-upload" aria-hidden="true" style="cursor: pointer;"></i>
                        </button>
                        <div class="modal fade" id="KQUVModal3" tabindex="-1" role="dialog" aria-labelledby="UVModal" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="KQUVModal3Label">File đánh giá kết quả phỏng vấn</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <form method="POST" action="/upload_danhgia_uvtd_pv3" enctype="multipart/form-data">
                                    <div class="modal-body">
                                        <div class="container">
                                            <div class="row">
                                                <div class="col-sm-6">
                                                    <div class="form-group">
                                                        <input type="file" class="form-control" name="file" required>
                                                        <input type="hidden" name="id" value={{row[0]}}>
                                                        <input type="hidden" name="id_yctd" value={{row[17]}}>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <input type="submit" class="btn btn-primary" value="Tải lên"></input>
                                        </form>
                                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Quay lại</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        {% endif %}
                    </td>
                    <td>
                        {% if current_user.phanquyen == "td" or current_user.phanquyen == "sa" %}
                        <form action="/thaydoi_trangthai_uvtd" method="POST">
                            <input type="hidden" name="id" value={{row[0]}}>
                            <input type="hidden" name="id_yctd" value={{row[17]}}>
                            {% if not row[15] or row[15]=="Chưa phỏng vấn" %}
                            <select name="trangthai" onchange="form.submit()">
                                <option selected>Chưa phỏng vấn</option>
                                <option value="Đang phỏng vấn">Đang phỏng vấn</option>
                                <option value="Qua phỏng vấn">Qua phỏng vấn</option>
                                <option value="Trượt phỏng vấn">Trượt phỏng vấn</option>
                            </select>
                            {% elif row[15]=="Đang phỏng vấn" %}
                            <select name="trangthai" onchange="form.submit()">
                                <option >Chưa phỏng vấn</option>
                                <option value="Đang phỏng vấn" selected>Đang phỏng vấn</option>
                                <option value="Qua phỏng vấn">Qua phỏng vấn</option>
                                <option value="Trượt phỏng vấn">Trượt phỏng vấn</option>
                            </select>
                            {% elif row[15]=="Qua phỏng vấn" %}
                            <select name="trangthai" onchange="form.submit()">
                                <option >Chưa phỏng vấn</option>
                                <option value="Đang phỏng vấn">Đang phỏng vấn</option>
                                <option value="Qua phỏng vấn" selected>Qua phỏng vấn</option>
                                <option value="Trượt phỏng vấn">Trượt phỏng vấn</option>
                            </select>
                            {% elif row[15]=="Trượt phỏng vấn" %}
                            <select name="trangthai" onchange="form.submit()">
                                <option >Chưa phỏng vấn</option>
                                <option value="Đang phỏng vấn">Đang phỏng vấn</option>
                                <option value="Qua phỏng vấn">Qua phỏng vấn</option>
                                <option value="Trượt phỏng vấn" selected>Trượt phỏng vấn</option>
                            </select>
                            {% else %}
                            <select name="trangthai" onchange="form.submit()">
                                <option value=""></option>
                                <option value="Chưa phỏng vấn">Chưa phỏng vấn</option>
                                <option value="Đang phỏng vấn">Đang phỏng vấn</option>
                                <option value="Qua phỏng vấn">Qua phỏng vấn</option>
                                <option value="Trượt phỏng vấn">Trượt phỏng vấn</option>
                            </select>
                            {% endif %}
                        </form>
                        {% else %}
                        {{ row[15] }}
                        {% endif %}
                    </td>
                    <td>
                        {% if current_user.phanquyen == "td" or current_user.phanquyen == "sa" %}
                        <form action="/thaydoi_ghichu_uvtd" method="POST">
                            <input type="hidden" name="id" value={{row[0]}}>
                            <input type="hidden" name="id_yctd" value={{row[17]}}>
                            {% if row[16] %}
                            <input type="text" name="ghichu" value="{{ row[16] }}" onchange="form.submit()">  
                            {% else %}
                            <input type="text" name="ghichu" value="" onchange="form.submit()"> 
                            {% endif %}
                        </form>
                        {% else %}
                        {{ row[16] }}
                        {% endif %}
                    </td>  
                    <td>
                        {% if current_user.phanquyen == "td" or current_user.phanquyen == "sa" %}
                        <form action="/xoa_uvtd" method="POST">
                            <button class="btn btn-danger" type="submit"><i class="fa fa-lg fa-trash"></i></button>
                            <input type="hidden" name="id" value={{row[0]}}>
                            <input type="hidden" name="id_yctd" value={{row[17]}}>
                        </form>
                        {% endif %}
                    </td>  

                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
</div>
<script>

    function openFile(path) { 
        window.open(path, '_blank'); 
    };

    document.addEventListener('DOMContentLoaded', (event) => {
        const td_elements = document.querySelectorAll('td');

        td_elements.forEach((element) => {
            if (element.textContent === 'None') {
                element.textContent = '';
            }
        });

        const inputs= document.querySelectorAll('input');

        inputs.forEach((element) => {
            element.style.border = 'none';
            if (element.textContent === 'None') {
                element.textContent = '';
            }
        });

        const selects = document.querySelectorAll('select');

        selects.forEach((element) => {
            element.style.border = 'none';
        });

    })
</script>
{% endblock content %}