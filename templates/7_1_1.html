{% extends  "base.html" %}
{% block style%}
<style>
    table{
        width: 500px;
        
    }
    table, th, td {
        font-size: 12px;
        font-weight:bold;
        color: black;
        border-collapse: collapse;  
        text-align: center;
    }
    th {
        text-align: center;
        color: white;
    }
    table td {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 200px; /* Adjust based on your requirement */
    }
    td, label, p, input, h5,select {
        color: #4e73df;
        font-weight: bold;
    }
    .col {
        border-right: 1px solid #dee2e6;
        text-align: center;
        justify-content: center;
        align-items: center;
        width: 30%;
        font-size: 12px;
    }

    label, input, select {
        width: 100px;
        margin-left: 10px;
    }
    .pagination {
        margin-left: 50px;
        font-size: 12px;
    }
    #excel {
        margin-left: 20px;
    }
    input_ca {
        border: none;
        outline: none;
    }
</style>
{% endblock style %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col">
            <div style="display: flex; align-items: center;">
            <h5>Cập nhật theo nhóm </h5>
            <form action='/taimaudoicanhom' method="POST">
                <input class="btn btn-primary btn-sm" value="Tải mẫu" type="submit" style="font-size:12px;"></input>
            </form>
            </div>
            <hr />
            <br>
            <form action="/doicanhom" method="POST" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="cacongty">Cả công ty</label>
                    <select id="cacongty" name="cacongty">
                        <option value="">Chọn</option>
                        <option value="Có">Có</option>                        
                    </select>
                </div>
                <div class="form-group">
                    <label for="phongban">Phòng ban</label>
                    <input id="phongban" name="phongban"></input>
                </div>
                <div class="form-group">
                    <label for="chuyento">Chuyền tổ</label>
                    <input id="chuyento" name="chuyento"></input>
                </div>
                <div class="form-group">
                    <label for="camoinhom">Ca mới</label>
                    <select id="camoinhom" name="camoinhom">
                        {% for ca in cacca %}
                        <option value={{ca}}>{{ca}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="ngaybatdau">Ngày bắt đầu</label>
                    <input id="ngaybatdau" name="ngaybatdau" type="date">
                </div>
                <div class="form-group">
                    <label for="ngayketthuc">Ngày kết thúc</label>
                    <input id="ngayketthuc" name="ngayketthuc" type="date">
                </div>
                <div class="form-group">
                    <label for="file">Cập nhật theo file</label>
                    <input id="file" name="file" type="file">
                </div>
                <input type="submit" class="btn btn-primary btn-sm" value="Cập nhật"></input>
            </form>
        </div>
        <div class="col">
            <h5>Cập nhật theo cá nhân</h5>
            <hr />
            <br>
            <form action="/doicacanhan" method="POST">
                <div class="form-group">
                    <label for="mst">Mã số thẻ</label>
                    <input id="mst" name="mst" type="text">
                </div>
                <div class="form-group">
                    <label for="cacu">Ca cũ</label>
                    <input id="cacu" name="cacu" type="text" readonly> 
                </div>
                <div class="form-group">
                    <label for="camoi">Ca mới</label>
                    <select id="camoi" name="camoi">
                        {% for ca in cacca %}
                        <option value={{ca}}>{{ca}}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="form-group">
                    <label for="ngaybatdau">Ngày bắt đầu</label>
                    <input id="ngaybatdau" name="ngaybatdau" type="date">
                </div>
                <div class="form-group">
                    <label for="ngayketthuc">Ngày kết thúc</label>
                    <input id="ngayketthuc" name="ngayketthuc" type="date">
                </div>
                <br>
                <input type="submit" class="btn btn-primary btn-sm" value="Cập nhật"></input>
            </form>
        </div>
        <div class="col">
            <h5>Danh sách ca làm việc</h5>
            <hr />
            <table class="table table-sm">
                <thead>
                    <tr class="bg-primary">
                        <th scope="col">Ca</th>
                        <th scope="col">Giờ nghỉ trưa</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>A1-01</td>
                        <td>11:15 - 12:15</td>
                    </tr>
                    <tr>
                        <td>A1-02</td>
                        <td>11:30 - 12:30</td>
                    </tr>
                    <tr>
                        <td>A1-03</td>
                        <td>11:50 - 12:50</td>
                    </tr>
                    <tr>
                        <td>A1-04</td>
                        <td>12:00 - 13:00</td>
                    </tr>
                    <tr>
                        <td>A3-01</td>
                        <td>11:15 - 12:15</td>
                    </tr>
                    <tr>
                        <td>A3-02</td>
                        <td>11:30 - 12:30</td>
                    </tr>
                    <tr>
                        <td>A3-03</td>
                        <td>11:50 - 12:50</td>
                    </tr>
                    <tr>
                        <td>A3-04</td>
                        <td>12:00 - 13:00</td>
                    </tr>
                    <tr>
                        <td>E1-01</td>
                        <td>11:15 - 12:15</td>
                    </tr>
                    <tr>
                        <td>E1-02</td>
                        <td>11:30 - 12:30</td>
                    </tr>
                    <tr>
                        <td>E1-03</td>
                        <td>11:50 - 12:50</td>
                    </tr>
                    <tr>
                        <td>E1-04</td>
                        <td>12:00 - 13:00</td>
                    </tr>
                    <tr>
                        <td>F1-01</td>
                        <td>11:15 - 12:15</td>
                    </tr>
                    <tr>
                        <td>F1-02</td>
                        <td>11:30 - 12:30</td>
                    </tr>
                    <tr>
                        <td>F1-03</td>
                        <td>11:50 - 12:50</td>
                    </tr>
                    <tr>
                        <td>F1-04</td>
                        <td>12:00 - 13:00</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <hr />  
    <div class="row">
        <h5>Lịch sử đổi ca làm việc</h5>
        <div style="display: flex; align-items: center;">
            <form method="GET">
                <div class="form-group">
                    <input id="mst" name="mst" type="text" onchange="this.form.submit()" placeholder='Mã số thẻ' value="{{request.args.get('mst','')}}">
                    <input id="chuyen" name="chuyen" type="text" onchange="this.form.submit()" placeholder='Chuyền' value="{{request.args.get('chuyen','')}}">
                    <input id="phongban" name="phongban" type="text" onchange="this.form.submit()" placeholder='Phòng ban' value="{{request.args.get('phongban','')}}">
                </div>
            </form>
            <div class='pagination'>{{ pagination.links }}</div>
            <form method="POST">
                <input id="mst" name="mst" type="text" hidden value="{{request.args.get('mst','')}}">
                <input id="chuyen" name="chuyen" type="text" hidden value="{{request.args.get('chuyen','')}}">
                <input id="phongban" name="phongban" type="text" hidden value="{{request.args.get('phongban','')}}">
                <input type="submit" class="btn btn-success btn-sm" value="Xuất Excel" id="excel"></input>
            </form>    
        </div>
        <table class="table table-hover table-sm">
            <thead>
                <tr class="bg-primary">
                    <th>Mã số thẻ</th>
                    <th>Họ tên</th>
                    <th>Chuyền</th>
                    <th>Phòng ban</th>
                    <th>Ca</th>
                    <th>Đổi từ ngày</th>
                    <th>Đến ngày</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                {% for row in danhsach %}
                <tr data-info='{{ row  | safe }}'>
                    <form action="/suadoi_dangky_ca" method="POST">
                        <input type="hidden" name="mst_filter" value={{request.args.get('mst', '')}}></input>
                        <input type="hidden" name="chuyen_filter" value={{request.args.get('mst', '')}}></input>
                        <input type="hidden" name="bophan_filter" value={{request.args.get('mst', '')}}></input>
                        <input type="hidden" name="id" value={{row[8]}}></input>
                        <td>{{row[1]}}</td>
                        <td>{{row[2]}}</td>
                        <td>{{row[3]}}</td>
                        <td>{{row[4]}}</td>
                        <td><input class="input_ca" name="ca" value={{row[5]}} onchange='this.form.submit()'> </td>
                        <td class="date_en">{{row[6]}}</td>
                        <td class="date_en">{{row[7]}}</td>
                    </form>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
    </div>
    
    <script>
        document.getElementById('mst').addEventListener("change", function(event) {
            axios({
                method: 'post',
                url: '/laycatheomst?mst=' + document.getElementById('mst').value
            }).then(function(response) {
                console.log(response.data)
                document.getElementById('cacu').value = response.data['Ca']
            })
        })

        function changeFormatDate(date){
            if(date == 'None') return "";
            try{
                return date.split("-")[2] + "/" + date.split("-")[1] + "/" + date.split("-")[0];
            } catch {
                return "";    
        }}
        document.addEventListener('DOMContentLoaded', (event) => {
            document.querySelectorAll('.date_en').forEach((element) => {
                element.textContent = changeFormatDate(element.textContent);
            });
        });

    </script>
</div>
{% endblock content %}
