{% extends  "base.html" %}
{% block style%}
<style>
table, th, td {
    font-size: 10px;
}
input, select , label {
    margin-left: 10px;
    width: 100px;
    font-size: 10px;
}
.view-details {
    cursor: pointer;
    color: blue;
    text-decoration: underline;
}

.popup {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 50%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
    padding-top: 60px;
}

.popup-content {
    background-color: #fff;
    margin: 5% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
}

.close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
}

.close:hover,
.close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
}
</style>
{% endblock style %}
{% block content %}
<br>
<div class="container-fluid">
    <h5>Danh sách nhân viên</h5>
    <form action="/" method="POST" id="filter_form">
        <div class="form-group">
            <label for="mst">Mã nhân viên</label>
            <input type="text" id="mst" name="mst">
            <label for="hoten">Họ tên</label>
            <input type="text" id="hoten" name="hoten">
            <label for="sdt">Số điện thoại</label>
            <input type="text" id="sdt" name="sdt">
            <label for="trangthai">Trạng thái</label>
            <select id="trangthai" name="trangthai">
                {% for trangthai in cactrangthai %}
                    <option value="{{ trangthai }}">{{ trangthai }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="cccd">CCCD</label>
            <input type="text" id="cccd" name="cccd">
            <label for="phongban">Phòng ban </label>
            <select id="phongban" name="phongban">
                <option value="">Chọn phòng ban</option>
                {% for phongban in cacphongban %}
                    <option value="{{ phongban }}">{{ phongban }}</option>
                {% endfor %}
            </select>
            <label for="gioitinh">Giới tính</label>
            <select id="gioitinh" name="gioitinh">
                <option value="">Chọn giới tính</option>
                <option value="Nam">Nam</option>
                <option value="Nữ">Nữ</option>
            </select>
            <label for="hccategory">HC Category</label>
            <select id="hccategory" name="hccategory">
                <option value="">Chọn HC Category</option>
                {% for hccategory in cachccategory %}
                    <option value="{{ hccategory }}">{{ hccategory }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="ngaykyhd">Ngày ký HĐ</label>
            <input type="date" id="ngaykyhd" name="ngaykyhd">
            <label for="ngayhethanhd">Ngày hết hạn HĐ</label>
            <input type="date" id="ngayhethanhd" name="ngayhethanhd">
            <label for="ngayvao">Ngày vào</label>
            <input type="date" id="ngayvao" name="ngayvao">
            <label for="ngaynghi">Ngày nghỉ</label>
            <input type="date" id="ngaynghi" name="ngaynghi">
        </div>
        <div class="form-group">
            <input class="btn btn-primary" type="submit" value="Tìm kiếm"></input>
        </div>
    </form>
</div> 

<hr />

<div>
    <b>Tổng số nhân viên: {{count}}</b>
</div> 

<div>
    <form action="/export_dsnv" method="POST">
        <div class="form-group">
            <input type="text" id="mst" name="mst" value="{{ request.args.get('mst', '') }}" hidden>
            <input type="text" id="hoten" name="hoten" value="{{ request.args.get('hoten', '') }}" hidden>
            <input type="text" id="sdt" name="sdt" value="{{ request.args.get('sdt', '') }}" hidden>
            <input type="text" id="trangthai" name="trangthai" value="{{ request.args.get('trangthai', '') }}" hidden>
            <input type="text" id="cccd" name="cccd" value="{{ request.args.get('cccd', '') }}" hidden>
            <input type="text" id="gioitinh" name="gioitinh" value="{{ request.args.get('gioitinh', '') }}" hidden>
            <input type="text" id="phongban" name="phongban" value="{{ request.args.get('phongban', '') }}" hidden>
            <input type="text" id="hccategory" name="hccategory" value="{{ request.args.get('hccategory', '') }}" hidden>
            <input type="date" id="ngaykyhd" name="ngaykyhd" value="{{ request.args.get('ngaykyhd', '') }}" hidden>
            <input type="date" id="ngayhethanhd" name="ngayhethanhd" value="{{ request.args.get('ngayhethanhd', '') }}" hidden>
            <input type="date" id="ngayvao" name="ngayvao" value="{{ request.args.get('ngayvao', '') }}" hidden>
            <input type="date" id="ngaynghi" name="ngaynghi" value="{{ request.args.get('ngaynghi', '') }}" hidden>
            <input class="btn btn-success" type="submit" value="Xuất Excel"></input>
        </div>
    </form>
</div>

<table class="table table-hover">
    <thead>
        <tr>
            <th scope="col">#</th>
            <th scope="col">Mã nhân viên</th>
            <th scope="col">Họ và tên</th>
            <th scope="col">Ngày vào</th>
            <th scope="col">Detail job title(VN)</th>
            <th scope="col">Department</th>
            <th scope="col">Line</th>
            <th scope="col">Trạng thái</th>
            <th scope="col">Xoá</th>
        </tr>
    </thead>
    <tbody>
        {% for user in users %}
            <tr data-info='{{ user | tojson | safe }}'>
                <td>{{ loop.index + (pagination.page - 1) * pagination.per_page }}</td>
                <td>{{ user["MST"] }}</td>
                <td>{{ user["Họ tên"] }}</td>
                <td>{{ user["Ngày vào"] }}</td>
                <td>{{ user["Job title VN"] }}</td>
                <td>{{ user["Department"] }}</td>
                <td>{{ user["Line"] }}</td>
                <td>{{ user["Trạng thái"] }}</td>
                <td><a class="fas fa-fw fa-eye  view-details" href="#" >Xem</a></td>
            </tr>
        {% endfor %}
    </tbody>
</table>
<div class="pagination">{{ pagination.links }}</div>

<div id="popup" class="popup">
    <div class="popup-content">
        <span class="close">&times;</span>
        <p id="employeeInfo"></p>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', (event) => {
        const popup = document.getElementById('popup');
        const popupContent = document.getElementById('employeeInfo');
        const closeBtn = document.getElementsByClassName('close')[0];
    
        document.querySelectorAll('.view-details').forEach(item => {
            item.addEventListener('click', event => {
                event.preventDefault(); // Ngăn chặn hành động mặc định của thẻ <a>
                const row = event.target.closest('tr');
                const info = JSON.parse(row.dataset.info);
                console.log(info);
    
                popupContent.innerHTML = `
                    <strong>MST:</strong> ${info["MST"]}<br>
                    <strong>Họ tên:</strong> ${info["Họ tên"]}<br>
                    <strong>Thẻ chấm công:</strong> ${info["Thẻ chấm công"]}<br>
                    <strong>Số điện thoại:</strong> ${info["Số điện thoại"]}<br>
                    <strong>Ngày sinh:</strong> ${info["Ngày sinh"]}<br>
                    <strong>Giới tính:</strong> ${info["Giới tính"]}<br>
                    <strong>CCCD:</strong> ${info["CCCD"]}<br>
                    <strong>Ngày cấp CCCD:</strong> ${info["Ngày cấp CCCD"]}<br>
                    <strong>Thường trú:</strong> ${info["Thường trú"]}<br>
                    <strong>Dân tộc:</strong> ${info["Dân tộc"]}<br>
                    <strong>Học vấn:</strong> ${info["Học vấn"]}<br>
                    <strong>Ngày vào:</strong> ${info["Ngày vào"]}<br>
                    <strong>Job title VN:</strong> ${info["Job title VN"]}<br>
                    <strong>Department:</strong> ${info["Department"]}<br>
                    <strong>Line:</strong> ${info["Line"]}<br>
                    <strong>Người thân:</strong> ${info["Người thân"]}<br>
                    <strong>SĐT người thân:</strong> ${info["SĐT liên hệ"]}<br>
                    <strong>Loại hợp đồng:</strong> ${info["Loại hợp đồng"]}<br>
                    <strong>Trạng thái:</strong> ${info["Trạng thái"]}<br>
                `;
    
                popup.style.display = 'block';
            });
        });
    
        closeBtn.onclick = function() {
            popup.style.display = 'none';
        }
    
        window.onclick = function(event) {
            if (event.target == popup) {
                popup.style.display = 'none';
            }
        }
    });
    
</script>


{% endblock content %}
